<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.2.1/axios.min.js"></script>

</head>

<body>
    <div class="container mt-5">
        <div class="row">
            <button type="button" class="btn btn-success col-2 mx-2" onclick="GetAll()">All Users</button>
            <button type="button" class="btn btn-success col-2 mx-2" onclick="GetUser()">Get User</button>
        </div>
        <div id="root" class="row m-0 mt-3">
            <div class="col-5">
                <!-- <form id="formCreate" method="post" action="https://639935b029930e2bb3cc9fb8.mockapi.io/rmad101/users"> -->
                <form id="formCreate">
                    <div class="mb-3">
                        <label for="exampleInputPassword1" class="form-label">Full Name</label>
                        <input required name="name" type="text" class="form-control" id="exampleInputPassword1">
                    </div>
                    <div class="mb-3">
                        <label for="exampleInputEmail1" class="form-label">Email address</label>
                        <input required name="email" type="email" class="form-control" id="exampleInputEmail1"
                            aria-describedby="emailHelp">
                    </div>
                    <div class="mb-3">
                        <label for="exampleInputEmail1" class="form-label">Avatar url</label>
                        <input required name="avatar" type="url" class="form-control" id="exampleCheck1">
                    </div>
                    <button type="reset" class="btn btn-warning">Reset</button>
                    <button type="submit" class="btn btn-primary">Create</button>
                </form>
            </div>
        </div>
    </div>
    <script>
        let formCreate = document.getElementById("formCreate");

        let instance = axios.create({
            baseURL: "https://639935b029930e2bb3cc9fb8.mockapi.io/rmad101/",
            timeout: 10000
        })

        //alert-dən id-ni götürüb GetById(id) funksiyasını çağırır. 
        function GetUser() {
            root.innerHTML = "";
            let id = prompt("Id daxil edin");
            GetById(id);
        }

        //bu funksiya işə düşdükdə apidan bütün userlərin hər biri üçün dataları GenerateCard
        //methoduna yollayır 
        function GetAll() {
            root.innerHTML = "";
            instance.get("users")
                .then(res => {
                    let data = res.data;
                    data.forEach(element => {
                        GenerateCard(element);
                    });
                });
        }


        //API-a get request atır. Göndərilən id-li elementi GenerateCard methoduna yollayır
        function GetById(id) {
            //axios request
            instance.get(`users/${id}`)
                .then(res => GenerateCard(res.data));
        }


        //Bu method göndərilən elementə uyğun card hazırlayır.
        function GenerateCard(element) {
            let cardDiv = document.createElement('div');
            cardDiv.classList.add("card", "col-3");

            let img = document.createElement("img");
            img.classList.add('card-img-top');
            img.src = element.avatar;

            let cardBodyDiv = document.createElement('div');
            cardBodyDiv.classList.add('card-body');

            let h5 = document.createElement('h5');
            h5.classList.add('card-title');
            h5.innerText = element.name;

            let p = document.createElement('p');
            p.classList.add('card-text');
            p.innerText = element.email ? element.email : "";

            let button = document.createElement("button");
            button.classList.add("btn", "btn-danger");
            button.value = element.id;
            button.innerText = "X";
            button.setAttribute('onClick', "DeleteById(this)")

            cardBodyDiv.append(h5, p, button);
            cardDiv.append(img, cardBodyDiv);

            root.appendChild(cardDiv);
        }


        function CreateUser(fullName, email, avatarURL) {
            instance.post("users", {
                name: fullName,
                email: email,
                avatar: avatarURL
            })
                .then(res => console.log(res));
        }

        //formun submiti
        formCreate.addEventListener("submit", (e) => {
            e.preventDefault();//htmdəki submiti sıfırlayır (Refresh atmır)
            let formdata = new FormData(e.target);//Formu elave edirem
            let body = Object.fromEntries(formdata)//obyekte cevirmek 
            //{
            //     "name": "",
            //     "email": "",
            //     "avatar":""
            // }
            //axiosa post request atılır

            instance.post("users", body).then(res => {
                formCreate.reset();
                res.status == 201 ? GenerateCard(res.data) : alert(res.status);
            });
        })


        //göndərilən elemetin value sunu götürün axiosa delete request atır
        function DeleteById(element) {
            // element = button
            instance.delete(`users/${element.value}`).then(res => {
                console.log(res);
                element.parentElement.parentElement.remove();
            });
        }
    </script>
</body>

</html>